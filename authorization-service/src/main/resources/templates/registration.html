<!DOCTYPE html>
<html
        lang="ru"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="https://www.thymeleaf.org"
>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Регистрация</title>
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous"
  />
  <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
  />
  <link rel="stylesheet" th:href="@{/css/style.css}"/>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
  <style>
    .page_layout {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      align-items: flex-start;
      justify-content: flex-start;
    }

    .page-layout__content-wrapper {
      height: 100vh;
      display: grid;
      grid-template-rows: min-content auto;
    }

    .register-page__content {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      align-items: center;
      justify-content: center;
    }

    .page-layout__content--no-header {
      height: 100vh;
    }

    .btn {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      align-items: center;
      justify-content: center;
      border-radius: 0.375rem;
      gap: 4px;
    }

    .form-layout {
      width: 400px;
      background-color: #ffffff;
      display: flex;
      flex-direction: column;
      flex-wrap: nowrap;
      align-items: stretch;
      justify-content: flex-start;
      gap: 12px;
    }

    /* label.error {
      color: red;
      font-style: italic;
      margin-top: 5px;
    }


    .error {
      font-size: 12px;
    }


    .error input {
      border-color: red;
    } */
  </style>
</head>
<body>
<main class="page_layout">
  <div class="page-layout__content-wrapper w-100 overflow-y-scroll">
    <div
            class="page-layout__content page-layout__content--no-header register-page__content"
    >
      <form
              class="form-layout p-3 rounded-3 shadow"
              id="myForm"
              th:action="@{/registration?code={code}(code=${code})}"
              th:object="${user}"
              method="post"
      >
        <span class="fs-3 text-primary text-center">Регистрация</span>

        <div class="w-100">
          <div class="input-group">
                <span class="input-group-text fs-6">@ <i class=""></i></span
                ><input
                  th:field="*{email}"
                  name="email"
                  class="form-control rounded-end"
                  type="text"
                  th:placeholder="${email}"
                  disabled=""
          />
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <div class="w-100">
          <div class="input-group">
                <span class="input-group-text fs-6">
                  <i class="bi bi-fonts"></i></span
                ><input
                  th:field="*{firstName}"
                  name="firstName"
                  class="form-control rounded-end"
                  type="text"
                  placeholder="Введите имя"
                  required
                  pattern="^([А-ЯЁA-Z][а-яёa-z]{1,})|([A-Z][a-z]{1,})$"
          />
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <div class="w-100">
          <div class="input-group">
                <span class="input-group-text fs-6">
                  <i class="bi bi-fonts"></i></span
                ><input
                  th:field="*{lastName}"
                  name="lastName"
                  class="form-control rounded-end"
                  type="text"
                  placeholder="Введите фамилию"
                  required
                  pattern="^([А-ЯЁA-Z][а-яёa-z]{1,})|([A-Z][a-z]{1,})$"
          />
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <div class="w-100">
          <div class="input-group">
                <span class="input-group-text fs-6">
                  <i class="bi bi-telephone"></i></span
                ><input
                  th:field="*{telephone}"
                  name="telephone"
                  id="phone"
                  class="form-control rounded-end"
                  type="tel"
                  placeholder="+7 (___)-___-__-__"
                  required
                  pattern="\+\d{1,3}\s\(\d{3}\)\s\d{3}-\d{2}-\d{2}"
                  maxlength="18"
          />
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <div class="w-100">
          <div class="input-group">
                <span class="input-group-text fs-6">
                  <i class="bi bi-people"></i></span
                ><input
                  th:field="*{studyGroup}"
                  name="group"
                  class="form-control rounded-end"
                  type="text"
                  placeholder="Введите номер группы"
          />
          </div>
        </div>

        <div class="w-100">
          <div class="input-group">
                <span class="input-group-text fs-6">
                  <i class="bi bi-key"></i></span
                ><input
                  th:field="*{password}"
                  name="password"
                  class="form-control rounded-end"
                  type="password"
                  placeholder="Введите пароль"
                  required
                  minlength="8"
          />
            <div class="invalid-feedback">
              Пароль должен состоять как минимум из 8 символов
            </div>
          </div>
        </div>

        <button type="submit" class="btn d-flex btn-primary">
          Зарегистрироваться
        </button>
      </form>
    </div>
  </div>
</main>

<script>
  //   $(document).ready(function () {
  //     $("#myForm").validate({
  //       errorPlacement: function (error, element) {
  //         error.insertAfter(element); // Перемещаем сообщение об ошибке после элемента
  //       },
  //       rules: {
  //         email: {
  //           required: true,
  //         },
  //       },
  //       messages: {
  //         email: {
  //           required: "Пожалуйста, заполните это поле!",
  //         },
  //       },
  //     });
  //   });

  var phoneInput = document.getElementById("phone");

  const prefixNumber = (str) => {
    if (str === "7") {
      return "7 (";
    }
    if (str === "8") {
      return "8 (";
    }
    if (str === "9") {
      return "7 (9";
    }
    return "7 (";
  };

  // ======================================
  phoneInput.addEventListener("input", (e) => {
    const value = phoneInput.value.replace(/\D+/g, "");
    const numberLength = 11;

    let result;
    if (phoneInput.value.includes("+8") || phoneInput.value[0] === "8") {
      result = "";
    } else {
      result = "+";
    }

    //
    for (let i = 0; i < value.length && i < numberLength; i++) {
      switch (i) {
        case 0:
          result += prefixNumber(value[i]);
          continue;
        case 4:
          result += ") ";
          break;
        case 7:
          result += "-";
          break;
        case 9:
          result += "-";
          break;
        default:
          break;
      }
      result += value[i];
    }
    //
    phoneInput.value = result;
  });

  function validateInput(input) {
    const errorElement = input.nextElementSibling;
    if (!input.checkValidity()) {
      errorElement.textContent = "Неверный формат данных";
      errorElement.style.display = "block";
    } else {
      errorElement.textContent = "";
      errorElement.style.display = "none";
    }

    if (
      !input.checkValidity() &&
      input.type === "password" &&
      input.value.length < 8
    ) {
      errorElement.textContent =
        "Пароль должен состоять как минимум из 8 символов";
      errorElement.style.display = "block";
    }
    if (!input.checkValidity() && input.type === "email") {
      errorElement.textContent = "Неверно введена почта";
      errorElement.style.display = "block";
    }
    if (!input.checkValidity() && input.placeholder === "Введите имя") {
      errorElement.textContent = "Неверно введено имя";
      errorElement.style.display = "block";
    }
    if (!input.checkValidity() && input.placeholder === "Введите фамилию") {
      errorElement.textContent = "Неверно введена фамилия";
      errorElement.style.display = "block";
    }
    if (!input.checkValidity() && input.type === "tel") {
      errorElement.textContent = "Неверно введен номер телефона";
      errorElement.style.display = "block";
    }
  }

  document.querySelector("form").addEventListener("submit", (event) => {
    inputs.forEach((input) => {
      const errorElement = input.nextElementSibling;
      validateInput(input); // Проверяем снова при отправке формы

      if (errorElement.textContent) {
        input.classList.add("is-invalid");
        event.preventDefault();
      } else {
        input.classList.remove("is-invalid");
      }
    });
  });
</script>
</body>
</html>